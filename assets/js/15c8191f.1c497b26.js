/*! For license information please see 15c8191f.1c497b26.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[98214],{18773:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var s=n(24246),a=n(71670);const o={id:"release-troubleshooting",title:"Troubleshooting"},i=void 0,r={id:"release-troubleshooting",title:"Troubleshooting",description:"Adding a Local Commit in a -stable branch",source:"@site/contributing/release-troubleshooting.md",sourceDirName:".",slug:"/release-troubleshooting",permalink:"/contributing/release-troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/react-native-website/blob/main/website/contributing/release-troubleshooting.md",tags:[],version:"current",lastUpdatedAt:1704504779,formattedLastUpdatedAt:"Jan 6, 2024",frontMatter:{id:"release-troubleshooting",title:"Troubleshooting"},sidebar:"contributing",previous:{title:"Minor Stable Patches",permalink:"/contributing/release-stable-patch"},next:{title:"Updating monorepo packages",permalink:"/contributing/release-updating-packages"}},l={},c=[{value:"Adding a Local Commit in a -stable branch",id:"adding-a-local-commit-in-a--stable-branch",level:3},{value:"The Git Tag Has Been Pushed to Remote but CI Failed to Release to NPM",id:"the-git-tag-has-been-pushed-to-remote-but-ci-failed-to-release-to-npm",level:3},{value:"Manually set npm tags",id:"manually-set-npm-tags",level:3},{value:"Add Git Tags",id:"add-git-tags",level:3}];function h(e){const t=Object.assign({h3:"h3",p:"p",code:"code",ol:"ol",li:"li",strong:"strong",a:"a",pre:"pre",ul:"ul"},(0,a.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h3,{id:"adding-a-local-commit-in-a--stable-branch",children:"Adding a Local Commit in a -stable branch"}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"-stable"})," branches (contrary to main branch), the release crew can directly push new commits to quickly address issues. After applying the necessary changes, those changes need to be re-implemented in ",(0,s.jsx)(t.code,{children:"main"}),"; this is to avoid inconsistent state across branches, and to prevent having the same failures in future releases."]}),"\n",(0,s.jsx)(t.p,{children:"To make sure not to forget about these changes, we follow some best practices:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["When adding a local commit to the ",(0,s.jsx)(t.code,{children:"stable"})," branch, the commit message should follow the format:\n",(0,s.jsx)(t.code,{children:"[LOCAL] <fix or change applied to the repo>"})]}),"\n",(0,s.jsxs)(t.li,{children:["After the commit:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["open the ",(0,s.jsx)(t.strong,{children:"Road to 0.X.0"})," discussion (e.g: ",(0,s.jsx)(t.a,{href:"https://github.com/reactwg/react-native-releases/discussions/41",children:"Road to 0.71.0"}),") or the ",(0,s.jsx)(t.strong,{children:"Should we release 0.X.Y"})," discussion (e.g.: ",(0,s.jsx)(t.a,{href:"https://github.com/reactwg/react-native-releases/discussions/48",children:"Should we release 0.70.7"}),")"]}),"\n",(0,s.jsxs)(t.li,{children:["edit the main message adding the link to your commit under the ",(0,s.jsx)(t.strong,{children:"Local commits to backport to main"})," section"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Once the issue in the ",(0,s.jsx)(t.code,{children:"-stable"})," branch is handled, make sure to backport the fixes to main. When the PR backporting the fix is open against ",(0,s.jsx)(t.code,{children:"main"}),", make sure to update the relevant release discussion by adding the link to the PR right below the local commit in the ",(0,s.jsx)(t.strong,{children:"Local commits to backport to main"})," section. This makes it easier to keep track that the local commit has been taken care of."]}),"\n",(0,s.jsx)(t.p,{children:"Typically, the author of the original change should backport it. In that way, the commit's attribution is preserved. If the author is not available (for example, they are in PTO or in a different timezone and the backporting is urgent to unblock other work), anyone can take care of it."}),"\n",(0,s.jsx)(t.h3,{id:"the-git-tag-has-been-pushed-to-remote-but-ci-failed-to-release-to-npm",children:"The Git Tag Has Been Pushed to Remote but CI Failed to Release to NPM"}),"\n",(0,s.jsx)(t.p,{children:"The release process is composed of various steps, of which two are key for the rollout:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Create a version tag on the GitHub repository"}),"\n",(0,s.jsx)(t.li,{children:"Publish all the artifacts on Maven and NPM"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Step 2 takes most of the CI time because it has to build all the artifacts and prefabs needed. It might happen that CI will fail during this part, not reaching the publish to NPM step."}),"\n",(0,s.jsx)(t.p,{children:"In case Step 1 completes successfully but Step 2 fails, the code in the stable branch is set to the new version, but it has failed to rollout. This means that we need to do some extra steps to be able to retry to publish this version.\nIf you end up in this situation, follow these steps:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Remove the tag that has been pushed (update the ",(0,s.jsx)(t.code,{children:"X"}),", ",(0,s.jsx)(t.code,{children:"Y"})," and ",(0,s.jsx)(t.code,{children:"k"})," values appropriately):","\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"git tag -d v0.X.Y[-RC.k]\ngit push origin :v0.X.Y[-RC.k]\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Revert the commit pushed by Step 1. The script we use for the release updates the version numbers all across the codebase in many files (",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/commit/38465f2d184a2558681a6b6b45163694c885bd39",children:"here's an example"}),"). The commit usually has this title ",(0,s.jsx)(t.code,{children:"[0.X.Y-rc.k] Bump version numbers"})," for RCs or ",(0,s.jsx)(t.code,{children:"[0.X.Y] Bump version numbers"})," for stable releases.","\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"git revert <sha of the commit>\ngit push origin 0.X-stable\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Apply all the necessary fixes in the ",(0,s.jsx)(t.code,{children:"-stable"})," branch of the codebase. The remedies for this could be of two types:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"you forgot to cherry-pick some commits. In this case, you follow the standard cherry-pick procedure for RCs and patches."}),"\n",(0,s.jsxs)(t.li,{children:["you need to fix some bugs in the code. See the ",(0,s.jsx)(t.a,{href:"#adding-a-local-commit-in-a--stable-branch",children:'"Add a local commit"'})," section."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Once you have pushed all the necessary commits in the branch, re-trigger the release process ",(0,s.jsx)(t.strong,{children:"with the same tag"})," via the usual script."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"manually-set-npm-tags",children:"Manually set npm tags"}),"\n",(0,s.jsx)(t.p,{children:'Say you accidentally forgot to mark a release as "latest" or "next"?'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# You'll need to first login:\nnpm login\n\n# Add a tag to a version\nnpm dist-tag add <pkg>@<version> [<tag>]\n\n# Remove a tag to a version\nnpm dist-tag rm <pkg>@<version> <tag>\n\n# List tags for react-native\nnpm dist-tag ls [<pkg>]\n\n# Example of setting latest to 0.66.4\nnpm dist-tag add react-native@0.66.4 latest\n"})}),"\n",(0,s.jsx)(t.h3,{id:"add-git-tags",children:"Add Git Tags"}),"\n",(0,s.jsx)(t.p,{children:"Say you accidentally forgot to add a tags to the release?"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'# Delete a tag (annotated or not) locally, then push to delete it remotely\ngit tag --delete tagname\ngit push origin :tagname\n\n# Add an annotated tag\ngit tag -a v0.65.3 -m "whatever message"\n\n# Make sure you pull with tags\ngit pull <remote> <branch> --tags\n\n# Make sure you push any local tags you added/removed\ngit push <remote> <branch> --follow-tags\n'})})]})}const d=function(e={}){const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?(0,s.jsx)(t,Object.assign({},e,{children:(0,s.jsx)(h,e)})):h(e)}},71426:(e,t,n)=>{var s=n(27378),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var s,o={},c=null,h=null;for(s in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)i.call(t,s)&&!l.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:a,type:e,key:c,ref:h,props:o,_owner:r.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},24246:(e,t,n)=>{e.exports=n(71426)},71670:(e,t,n)=>{n.d(t,{Zo:()=>r,ah:()=>o});var s=n(27378);const a=s.createContext({});function o(e){const t=s.useContext(a);return s.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const i={};function r({components:e,children:t,disableParentContext:n}){let r;return r=n?"function"==typeof e?e({}):e||i:o(e),s.createElement(a.Provider,{value:r},t)}}}]);